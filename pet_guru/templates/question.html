{% extends 'base/base.html' %} 
{% load static %} 
{% block content %}
{% block link %}
<link rel="stylesheet" href="{% static 'css/chat.css' %} "/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
{% endblock link %}
<div class="pageContainer">
  <header class="unam-primary sticky-top">
    <div class="container-fluid mainMenu">
      {% block navigation %} {% include 'base/nav.html' %} {% endblock %}
    </div>
  </header>
  <div id="cuestionContainer">
    <div class="py-3 container">
      <h2 class="text-center display-4">{{ titulo }}</h2>
      <h3 class="alert-heading text-center">Descripción de la consulta:</h3>
      <p class="py-3">{{instance.description}}</p>
      <p class="py-2 h4">Calificacón: <i class="fa fa-star" aria-hidden="true"></i></p>
    </div>
    <div id="cuestion" class="py-5 d-flex flex-column justify-content-center align-items-center">
      <div class="alert alert-success w-100 px-3 py-5" role="alert">
        <div class="row">
          <div class="col-sm-4 col-md-4">
            <h2 class="alert-heading text-center mb-4">Datos clínicos.</h2>
            <p>Especie: {{ instance.specie }}</p>
            {% for op in nombres %}
            <p>{{ op.name }}</p>
            {% endfor %}
          </div>
          <hr>
          <div class="col-sm-12 col-md-8">
            <div id="galleryContainer">
              <div id="gallery" style="display:none;">
                {% for image in images %}
                <img alt="Image 1 Title" src="{{image.image.url}}" data-image="{{image.image.url}}" data-description="Image 1 Description"> 
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Seccion de Comentarios -->
      <div class="container">
        {% if user == instance.user_question or user == instance.user_response and instance.status == 'RP' %}
        <div>
          <h1  class="text-center">Comentarios</h1>
          <form class="col-md-12" method="POST" enctype="multipart/form-data">
            {% csrf_token %}               
            <div class="form-row">
              <label class="col-md-2" for="id_message">Message:</label>
              <div class="col-md-10">
                <textarea class="form-control" name="message" cols="40" rows="10" maxlength="200" required id="id_message"></textarea>              
              </div>
            </div>
            <div class="form-row">
              <label class="col-md-2" for="id_document">Document:</label>
              <div class="col-md-10">
                <input class="form-control-file" type="file" name="document" id="id_document" />
              </div>
            </div>
            <div class="form-row">
              <label class="col-md-2" for="id_image">Image:</label>
              <div class="col-md-10">
                <input class="form-control-file" type="file" name="image" id="id_image" />
              </div>            
            </div>
            <div class="form-row">
              <button type="submit" name="submit" class="col-md-2 ml-md-auto btn btn-primary">Enviar</button>              
            </div>
            </form>                        
          </div>
        </div>      
        <div class="container messages-cont">
          {% for message in messages %}
          {% if request.user.username == message.handle|stringformat:"s" %}
          <div class="row justify-content-end">            
          {% else %}
          <div class="row justify-content-start">
          {% endif %}
            <div class="col-md-7 col-sm-7">
              <div class="card card-message">
                <div class="card-header text-left">
                  {{message.handle}}
                </div>
                <div class="card-body text-left">
                  <p>{{message.message}}</p>
                  {% if message.image %}
                  <a href="{{message.image.url}}">
                    <img style="height: 200px" src="{{message.image.url}}" alt=""> <br>
                  </a>
                  {% endif%}
                  {% if message.document %}
                   Descargar:
                  <a download href="{{message.document.url}}"> {{message.document|cut:"documents/"}}</a>
                  {% endif%} 
                </div>
                <div class="card-footer text-muted text-right">
                  <p>{{ message.formatted_timestamp }}</p>
                </div>
              </div>
            </div>
          </div>          
          {% endfor %}
        </div>
        
        </div>
        {% elif user.rol == 'TC' and instance.status == 'OP' %}
        <div class="container text-center">
          <p class="h2 mb-5 mt-5">¿{{ user }} quieres responder a esta pregunta?</p>
          <input type="submit" class="btn btn-primary" name="" value="Responder">
        </div>
        {% else %}
        <div class="container text-center">
          <p class="display-4">En espera de que un profesor responda tu pregunta.</p>
        </div>
        {% endif %}
      </div>      
    </div>
    {% endblock %} 
    {% block javascript%}
    <script type="text/javascript">
    $(function() {


    });
    </script>
    {% endblock javascript%}